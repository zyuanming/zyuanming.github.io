---
layout: post
title: YUV颜色编码
date: 2019-11-20
categories: blog
tags: [图像处理]
description: 图像处理

---

## 开源的查看器

https://github.com/IENT/YUView

## Xcode command line project 引入Image等外部资源

https://stackoverflow.com/questions/35093704/how-to-add-an-image-to-a-c-project-in-xcode


## YUV采样

YUV 的优点之一是，色度频道的采样率可比 Y 频道低，同时不会明显降低视觉质量。有一种表示法可用来描述 U 和 V 与 Y 的采样频率比例，这个表示法称为 A:B:C 表示法：
* 4:4:4 表示色度频道没有下采样。
* 4:2:2 表示 2:1 的水平下采样，没有垂直下采样。对于每两个 U 样例或 V 样例，每个扫描行都包含四个 Y 样例。
* 4:2:0 表示 2:1 的水平下采样，2:1 的垂直下采样。
* 4:1:1 表示 4:1 的水平下采样，没有垂直下采样。对于每个 U 样例或 V 样例，每个扫描行都包含四个 Y 样例。与其他格式相比，4:1:1 采样不太常用。

## YUV 4:2:0 采样

YUV 4:2:0 采样，并不是指只采样 U 分量而不采样 V 分量。而是指，在每一行扫描时，只扫描一种色度分量（U 或者 V），和 Y 分量按照 2 : 1 的方式采样。比如，第一行扫描时，YU 按照 2 : 1 的方式采样，那么第二行扫描时，YV 分量按照 2:1 的方式采样。对于每个色度分量来说，它的水平方向和竖直方向的采样和 Y 分量相比都是 2:1 。四个Y分量共享一个U分量和一个V分量。

如下图所示，来源于微软MSDN上的一篇[技术博客](1)

<div align = center>

![](https://i-msdn.sec.s-msft.com/dynimg/IC173152.gif)

</div>

其中，叉表示Y分量，圈表示UV分量，上面圈的位置放在四个叉的中间，仅仅是为了突出四个Y分量共享一个U分量和一个V分量

```
举个例子 ：
 
假设图像像素为：
 
[Y0 U0 V0]、[Y1 U1 V1]、 [Y2 U2 V2]、 [Y3 U3 V3]
[Y5 U5 V5]、[Y6 U6 V6]、 [Y7 U7 V7]、 [Y8 U8 V8]
 
那么采样的码流为：Y0 U0 Y1 Y2 U2 Y3 Y5 V5 Y6 Y7 V7 Y8
 
其中，每采样过一个像素点，都会采样其 Y 分量，而 U、V 分量就会间隔一行按照 2 : 1 进行采样。
 
最后映射出的像素点为：

[Y0 U0 V5]、[Y1 U0 V5]、[Y2 U2 V7]、[Y3 U2 V7]
[Y5 U0 V5]、[Y6 U0 V5]、[Y7 U2 V7]、[Y8 U2 V7]
```


> 下面YUV420P相关的处理，是在[视音频数据处理入门：RGB、YUV像素数据处理](https://blog.csdn.net/leixiaohua1020/article/details/50534150)这篇文章的基础上，在Mac平台进行实践后的解析，相关代码也是直接参考这篇文章里的。可以在GitHub上找到本章的项目代码

### 1. 分离YUV420P像素数据中的Y、U、V分量

如果视频帧的宽和高分别为w和h，那么一帧YUV420P像素数据一共占用w*h*3/2 Byte的数据。其中前w*h Byte存储Y，接着的w*h*1/4 Byte存储U，最后w*h*1/4 Byte存储V。下面将会把一张分辨率为256x256的名称为lena_256x256_yuv420p.yuv的YUV420P格式的像素数据文件分离成为三个文件：

```
output_420_y.y：纯Y数据，分辨率为256x256。
output_420_u.y：纯U数据，分辨率为128x128。
output_420_v.y：纯V数据，分辨率为128x128。
```

下方是原图 lena_256x256_yuv420p.yuv
![](/assets/images/2019/11-20-1.png)

下方是Y分量输出的灰度图 output_420_y.y

*注意：所有单独分量的输出，在YUView上显示时，都是按照Y分量去解析的，也就是以YUV 4:0:0 格式去解析。需要手动设置*
![](/assets/images/2019/11-20-yuv-y.png)

下方是U分量输出的 output_420_u.y
![](/assets/images/2019/11-20-yuv-u.png)

下方是V分量输出的 output_420_v.y
![](/assets/images/2019/11-20-yuv-v.png)

## 参考网址

1. [一文读懂 YUV 的采样与格式](https://glumes.com/post/ffmpeg/understand-yuv-format/)
2. [视音频数据处理入门：RGB、YUV像素数据处理](https://blog.csdn.net/leixiaohua1020/article/details/50534150)



[1]:http://irace.me/swift-profiling/